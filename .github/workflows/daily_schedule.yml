name: Toram Daily Report

# è¨­å®šè§¸ç™¼æ™‚æ©Ÿ
on:
  schedule:
    # å°ç£æ™‚é–“ (UTC+8) æ™šä¸Š 22:00 = UTC æ™‚é–“ ä¸‹åˆ 14:00
    - cron: '0 14 * * *'
  
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      # 1. ä¸‹è¼‰ç¨‹å¼ç¢¼
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. å®‰è£å¥—ä»¶
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy requests plotly scipy streamlit google-generativeai openpyxl

      # ====================================================
      # ğŸ‘‡ æ–°å¢ï¼šAPI è¨ºæ–·æ­¥é©Ÿ (å¦‚æœé€™å€‹å¤±æ•—ï¼ŒDiscord æœƒæ”¶åˆ°ç´…ç‡ˆ)
      # ====================================================
      - name: ğŸ› ï¸ Run API Debugger
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python debug_gemini.py
        # åŠ ä¸Šé€™å€‹ï¼Œå³ä½¿è¨ºæ–·å¤±æ•—ä¹Ÿä¸æœƒå¡ä½ï¼Œè®“ä¸‹é¢çš„ä¸»ç¨‹å¼ç¹¼çºŒè·‘ (å˜—è©¦ç”¨å‚™ç”¨æ–¹æ¡ˆ)
        continue-on-error: true

      # 4. åŸ·è¡Œä¸»ç¨‹å¼ (è¨˜å¾—ä½¿ç”¨æˆ‘ä¸Šé¢çµ¦ä½ çš„ã€Œä¿®å¾©ç‰ˆã€daily_report.py)
      - name: Run Daily Report
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python daily_report.py